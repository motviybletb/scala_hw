# Catmull–Clark Surface Subdivision

## Описание проекта

Этот проект реализует алгоритм [Catmull–Clark surface subdivision](https://rosettacode.org/wiki/Catmull%E2%80%93Clark_subdivision_surface), который применяется в компьютерной графике для сглаживания и уточнения полигональных поверхностей. Алгоритм принимает на вход полигональную сетку (состоящую из вершин и граней) и строит новую, более детализированную поверхность, состоящую исключительно из четырёхугольников.

Реализация полностью соответствует стандартному алгоритму Catmull–Clark и поддерживает обработку случаев с отверстиями (дырами) в исходной поверхности.

---

## Алгоритм работы

### 1. Вычисление точки грани
Для каждой грани вычисляется её центральная точка (`face point`), которая является средним арифметическим координат всех вершин этой грани.

### 2. Вычисление точки ребра
Для каждого ребра вычисляется промежуточная точка (`edge point`):
- Если ребро принадлежит **двум граням**, то `edge point` — это среднее между серединой самого ребра и центрами `face points` двух смежных граней.
- Если ребро принадлежит **всего одной грани** (граничит с дыркой), то `edge point` совпадает с серединой ребра.

### 3. Обновление координат вершин
Каждая старая вершина заменяется на новую позицию по следующей формуле:

$$\text{new_coords} = m_1 \cdot \text{old_coords} + m_2 \cdot \text{avg_face_points} + m_3 \cdot \text{avg_mid_edges}$$

Где:
- `old_coords` — исходная позиция вершины,
- `avg_face_points` — среднее значение `face points` всех граней, содержащих эту вершину,
- `avg_mid_edges` — среднее значение середин всех рёбер, к которым относится эта вершина,
- `m1 = (n - 3) / n`, где `n` — количество граней, содержащих вершину,
- `m2 = 1 / n`,
- `m3 = 2 / n`.

Если вершина находится **на границе дыры**, то:
- В расчёт берутся только середины рёбер, находящихся на границе дыры,
- Новая координата — это среднее между этими серединами и старой координатой.

### 4. Создание новых граней
Каждая исходная грань разбивается на несколько новых граней. Например:

#### Для треугольной грани `(a, b, c)` создаются следующие новые четырёхугольники:
- (a, edge<sub>ab</sub>, face<sub>abc</sub>, edge<sub>ca</sub>)
- (b, edge<sub>bc</sub>, face<sub>abc</sub>, edge<sub>ab</sub>)
- (c, edge<sub>ca</sub>, face<sub>abc</sub>, edge<sub>bc</sub>)

#### Для четырёхугольной грани `(a, b, c, d)` создаются следующие новые четырёхугольники:
- (a, edge<sub>ab</sub>, face<sub>abcd</sub>, edge<sub>da</sub>)
- (b, edge<sub>bc</sub>, face<sub>abcd</sub>, edge<sub>ab</sub>)
- (c, edge<sub>cd</sub>, face<sub>abcd</sub>, edge<sub>bc</sub>)
- (d, edge<sub>da</sub>, face<sub>abcd</sub>, edge<sub>cd</sub>)

---

## Поддержка дыр

Алгоритм корректно обрабатывает случаи, когда поверхность содержит **дыры**:
- Ребро считается **граничным для дыры**, если оно принадлежит только одной грани.
- Вершина считается **граничной**, если количество граней, к которым она принадлежит, не равно количеству рёбер, в которых она участвует.

---

## Пример использования

Программа демонстрирует работу алгоритма на примере куба. На экран выводится начальная и уточнённая поверхности. Количество итераций подразделения задаётся переменной `iterations`.
